## 第十五章 AHB-to-APBH Bridge with DMA (APBH-Bridge-DMA)
### 15.1 概述
&emsp;&emsp;AHB-to-APBH 桥接器为芯片提供了在 AHB 的 HCLK 上运行的廉价外设连接总线。 （APBH 中的 H 表示 APBH 与 HCLK 同步。）  
&emsp;&emsp;如下图所示，AHB-to-APBH 桥包括 AHB-to-APB PIO 桥，用于到 APB 设备的内存映射 I/O，以及用于该总线上的设备的中央 DMA 设施和一个 Arm内核的向量中断控制器。 每个 APB 外设，包括向量中断控制器，都在各自的章节中进行了记录。  
&emsp;&emsp;DMA 控制器使用 APBH 总线向每个外设传输读写数据。 这些设备没有单独的 DMA 总线。 DMA 对 APBH 总线的使用与 AHB 到 APB 桥功能对 APBH 的使用之间的争用由内部仲裁逻辑调解。 对于这两个单元之间的竞争，DMA 受到青睐，AHB 从设备将通过其 HREADY 输出报告“未准备好”，直到桥接传输完成。 仲裁器跟踪重复的锁定并反转优先级，保证 APB 上每四次传输一次 Arm 平台。 
### 15.2 时钟
&emsp;&emsp;此处的表格描述了 APBH 的时钟源。 有关时钟设置、配置和门控信息，请参阅时钟控制器模块 (CCM)。 
### 15.3 APBH DMA
&emsp;&emsp;DMA 支持四个通道的 DMA 服务，如下表所示。 共享 DMA 资源允许每个独立通道遵循简单的链式命令列表。 命令链使用通用结构构建，如图 15-2 所示。 
&emsp;&emsp;单个命令结构体或通道命令字指定由 DMA 执行以支持给定设备的许多操作。 因此，Arm 平台可以设置大型工作单元，将许多 DMA 通道命令字链接在一起，将它们传递给 DMA，并且在 DMA 完成中断发生之前不再关心设备。 目标是在 DMA 和设备中具有足够的智能，以将来自任何设备的中断频率保持在 1 KHz 以下（到达间隔长于 1 ms）。 
&emsp;&emsp;单个命令结构可以使用相同的 APB 总线向相关设备中的关键寄存器发出 32 位 PIO 写操作，并控制它用于将 DMA 数据字节写入设备。 例如，这允许向 GPMI 控制器发出一系列操作，以发送 NAND 命令字节、地址字节和数据传输，其中命令和地址结构完全受软件控制，但该传输的管理是由 DMA 自主处理的。 每个 DMA 结构可以附加 0-15 个 PIO 字。 CMDPIOWORDS 字段（如果非零）指示 DMA 引擎将这些字复制到 APB，从外设的第一个寄存器地址偏移量开始，并在每个周期递增寄存器偏移量。 
&emsp;&emsp;DMA 主机仅生成到 APBH 的正常读/写传输。 它不会生成设置、清除或切换 (SCT) 传输。 
&emsp;&emsp;在任何请求的 PIO 字传输到外设后，DMA 检查通道命令结构中的两位命令字段。 表 15-3 显示了 DMA 实现的四个命令。 
&emsp;&emsp;DMA_WRITE 操作将数据字节从相关外设复制到系统存储器（片上 RAM 或 SDRAM）。 






















## 第四十六章 SNVS 安全非易失性存储
### 46.1 概述


## 第五十二章 Temperature Monitor 温度监测器
### 52.1 概述
&emsp;&emsp;温度传感器模块基于与温度相关的电压到时间的转换来实现温度传感/转换功能。 
&emsp;&emsp;该模块具有报警功能，如果温度高于两个高温阈值和低于一个低温阈值，可以发出独立的中断信号。这些温度阈值是可编程的，并指定为低、高和紧急温度。紧急阈值是一个特殊的可编程阈值，因为如果温度升高到该值以上并且在系统复位控制器中启用了温度紧急复位中断，则硬件将假定软件不再控制热情况并启动芯片复位。 
&emsp;&emsp;为了避免错误的紧急温度启动复位，在连续四个转换周期满足温度紧急条件之前，紧急警报不会触发。也可以对自重复模式进行编程，该模式基于可编程的延迟执行温度感测操作。 
&emsp;&emsp;由于高温和低温阈值是可编程的，因此它们形成了一个可根据应用需求量身定制的滑动温度支架。 例如，在启动时，软件可以将低温阈值设置为系统的最低温度代码，将高温阈值设置为系统的最高工作温度。
&emsp;&emsp;然后，系统可以使用该模块来监控片上温度，并在设置高温中断时采取适当的措施，例如节流内核频率。 一旦设置了高温中断，系统就可以将低温阈值编程为所需的冷却温度。 然后系统将切换到监测低温警报并等待其中断被设置。 通过这种方案，一旦设置了低温中断，软件就可以确保温度已经冷却到安全水平，并且可以重复该过程。 
&emsp;&emsp;如上图所示，温度传感器使用并假设带隙参考、480MHz PLL 和 32KHz RTC 模块已正确编程并完全稳定以进行正确操作。 
### 52.2 软件使用指南
&emsp;&emsp;在系统正常运行期间，软件可以使用温度传感器计数器的输出 (TEMP_CNT) 和熔断器温度校准数据来确定片上运行温度或将过温中断警报设置在几°C 以内。
&emsp;&emsp;根据校准，可通过设备上的保险丝获得两组温度和计数器值。 这些数据点将对应于下面曲线中的点 (N1, T1) 和 (N2, T2)。 
&emsp;&emsp;在一次温度测量周期之后，软件应结合使用校准点和 TEMPMON_TEMPSENSE0[TEMP_CNT] 位域中的温度编码值，使用以下公式计算设备的温度： 
$$T_{meas} = T_2 - (N_{meas} - N_2) * ((T_2 - T_1)/(N_1 - N_2))$$
&emsp;&emsp;同样，为了确定要写入 TEMPMON_TEMPSENSE0 寄存器中的警报计数器值，用于基于温度的中断，可以根据所需的温度触发器对应使用的 $N_{meas}$ 值求解上述等式。
&emsp;&emsp;OCOTP_ANA1 寄存器中提供了温度校准点保险丝值。 在产品测试过程中，每个部件的温度校准值都是单独融合的。 下表描述了该寄存器的字段。 
### 52.3 TEMPMON 寄存器定义
#### 52.3.1 Tempsensor Control Register 0
&emsp;&emsp;此寄存器定义了温度传感器的基本控制位，除了在 tempsensor 中定义的采样频率。
* 31-20 ALARM_VALUE 温度计数值（原始传感器的输出），此值可以产生警告中断。
* 19-8 TEMP_CNT 上次的温度计数值。
* 2 FINISHED 表明上次采样有效。每次监测开始之后，sensor应该清空此位
  * 0 INVALID 上次监测还未准备好
  * 1 VALID 上次监测有效
* 1 MEASURE_TEMP 开始监测过程。如果在 TEMPSENSE1 寄存器中监测频率是0，此结果是单次转换。
  * 0 STOP 不开始监测过程
  * 1 START 开始监测过程
* 0 POWER_DOWN 此位控制传感器的电源开关
  * 0 POWER UP
  * 1 POWER DOWN
#### 52.3.2 Tempsensor Control Register 1
&emsp;&emsp;该寄存器定义了温度传感器的自动重复时间。 
#### 52.3.3 Tempsensor Control Register 2
* 27-16 PANIC_ALARM_VALUE 
* 11-0 LOW_ALARM_VALUE

## imx_thermal.c文件分析










