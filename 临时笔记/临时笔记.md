### gpio.txt GPIO接口
&emsp;&emsp;此目录中的文档详细说明了如何访问驱动程序中的 GPIO，以及如何编写 GPIO 的设备驱动程序。  
&emsp;&emsp;由于内核中 GPIO 接口的历史，有两种不同的方式来获取和使用 GPIO：
* 基于描述符的接口是操作 GPIO 的首选方式，并且由该目录中除 gpio-legacy.txt 之外的所有文件进行描述。
* gpio-legacy.txt 中记录了被认为已弃用（但出于兼容性原因仍可使用）的旧式基于整数的接口。 
#### 1 什么是GPIO
&emsp;&emsp;“通用输入/输出”(GPIO) 是一种灵活的软件控制数字信号。许多芯片都提供GPIO，这对于使用嵌入式和定制硬件的 Linux 开发人员来说是很熟悉的。每个 GPIO 代表一个连接到特定引脚或球栅阵列 (BGA) 封装上的“球”的位。电路板原理图显示了哪些外部硬件连接到哪些 GPIO。可以编写通用驱动程序，以便板子设置代码将此类引脚的配置数据传递给驱动程序。  
&emsp;&emsp;片上系统 (SOC) 处理器严重依赖 GPIO。在某些情况下，每个非专用引脚都可以配置为 GPIO；大多数芯片至少有几十个GPIO。可编程逻辑器件（如 FPGA）可以轻松提供 GPIO；电源管理器和音频编解码器等多功能芯片通常有一些这样的引脚，以帮助解决 SOC 上的引脚稀缺问题；还有使用 I2C 或 SPI 串行总线连接的“GPIO 扩展器”芯片。大多数 PC 南桥都有几十个支持 GPIO 的引脚（只有 BIOS 固件知道它们是如何使用的）。     
&emsp;&emsp;GPIO 的确切功能因系统而异。常用选项：
* 输出值是可写的（高=1，低=0）。一些芯片还可以选择如何驱动该值，例如，可能只驱动一个值，支持“线或”和其他值的类似方案（特别是“开漏”信号）。
* 输入值同样可读 (1, 0)。一些芯片支持配置为“输出”的引脚回读，这在这种“线或”情况下非常有用（以支持双向信号）。 GPIO 控制器可能具有输入去毛刺/去抖动逻辑，有时带有软件控制。
* 输入通常可以用作 IRQ 信号，通常是边沿触发，但有时是电平触发。此类 IRQ 可配置为系统唤醒事件，以将系统从低功率状态唤醒。
* 通常，GPIO 可配置为输入或输出，根据不同产品板的需要；单向的也存在。
* 大多数 GPIO 可以在持有自旋锁时访问，但那些通过串行总线访问的通常不能。一些系统支持这两种类型。  

&emsp;&emsp;在给定的板上，每个 GPIO 都用于一个特定的目的，例如监控 MMC/SD 卡的插入/移除、检测卡写保护状态、驱动 LED、配置收发器、位冲击串行总线、戳硬件看门狗、感测一个开关，等等。
#### 2 GPIO的常用属性
&emsp;&emsp;这些属性都在GPIO接口的其他文档中实现，理解他们很有用，尤其是当您需要定义GPIO映射时。  
##### 2.1 高电平有效和低电平有效
将GPIO输出“1”（高电平）作为有效，输出“0”（低电平）作为无效是很自然的事情。然而，实际上，GPIO的输出信号可能在输出之前被反转，也可能由设备通过反转来决定“有效”的定义。这样的决定应该对驱动透明，因此无论GPIO是高有效还是低有效，驱动程序都只需要考虑逻辑信号，而不是线路级的事情。
##### 2.2 开漏和Open source
&emsp;&emsp;有时共享信号需要使用“开漏”（实际上只驱动低信号电平），或“开源”（仅驱动高信号平）信号。该术语适用于 CMOS 晶体管； “集电极开路”用于 TTL。上拉或下拉电阻导高或低信号电平。这有时被称为“线与”；或者更实际地，从否定逻辑（低=真）的角度看，这是一个“线或”。  
&emsp;&emsp;开漏信号的一个常见示例是共享的低电平有效 IRQ 线。此外，双向数据总线信号有时使用开漏信号。  
&emsp;&emsp;一些GPIO控制器直接支持开漏和开源输出；许多控制器不支持。当您需要开漏信号但您的硬件不直接支持它时，您可以使用一个常见的用法来使用任何可用作输入或输出的 GPIO 引脚来模拟它：
```
 LOW：gpiod_direction_output(gpio, 0) ...这会驱动信号并覆盖上拉。
 HIGH：gpiod_direction_input(gpio) ...这会关闭输出，因此上拉（或其他设备）控制信号。
```
&emsp;&emsp;可以应用相同的逻辑来模拟开源信号，通过驱动高电平信号并将 GPIO 配置为低电平输入来实现。这种开漏/开源仿真可以由 GPIO 框架透明地处理。  
&emsp;&emsp;如果您将信号“驱动”为高电平，但 gpiod_get_value(gpio) 报告一个低值（在适当的上升时间过去之后），您就知道某个其他组件正在将共享信号驱动为低电平。这不一定是错误。举一个常见的例子，这就是 I2C 时钟的延长方式：需要较慢时钟的从设备延迟 SCK 的上升沿，而 I2C 主设备相应地调整其信号速率。
### consumer.txt GPIO描述符消费者接口
&emsp;&emsp;本文档描述了 GPIO 框架的消费者接口。 请注意，它描述了新的基于描述符的接口。 有关已弃用的基于整数的 GPIO 接口的说明，请参阅 gpio-legacy.txt。  
#### 1 GPIO消费者指南
&emsp;&emsp;没有标准 GPIO 调用就无法工作的驱动程序应该具有依赖于 GPIOLIB 的 Kconfig 条目。 通过包含以下文件，来允许驱动程序获取和使用 GPIO 的函数：   
&emsp;&emsp;`#include <linux/gpio/consumer.h>`  
&emsp;&emsp;所有与基于描述符的 GPIO 接口一起使用的函数都以 gpiod_ 为前缀。 gpio_ 前缀用于旧接口。 内核中的任何其他函数都不应使用这些前缀。 


